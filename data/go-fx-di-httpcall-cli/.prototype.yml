title: |
  [Go] uber-go/fx で curl もどきを作ってみる
description: |
  uber-go/fx は Go の DI ライブラリ。

  プログラム実行開始時に依存を決定するタイプ。
  どちらかというとフレームワークに近く、アプリケーション全体で導入するのが望ましい。

  学習コストがほんのちょっとあり、自分の理解を整理するためにもサンプルアプリを作ってみた。
published: '2024-12-18'

units:
  - title: サンプルアプリ
    description: |
      curl ライクな CLI を作ってみる。

      とは言っても GET しかできない。
      curl とは似ても似つかないが、まあサンプルなので良いと思う。
    terminal: |
      $ go run . -url https://example.com/
      <!doctype html>
      <html>
      <head>
          <title>Example Domain</title>
          
          // 省略
          // example.com へ HTTP GET リクエストをして、レスポンスボディを標準出力する
  
  - title: コード
    code:
      open: main.go
      include:
        - clientfx
        - clientfx/client.go
        - clientfx/module.go
        - cmdfx
        - cmdfx/cmd.go
        - cmdfx/module.go
        - logger.go
        - go.mod
      units:
        - title: fx.New()
          mark: main.go:10

        - description: |
            cmdfx.Module と clientfx.Module があり、
            両者を fx.New() に渡している。
          mark: main.go:11

        - description: |
            エントリポイント
          mark: main.go:15

        - title: cmdfx.Module
          description: |
            cmdfx.New() を fx に渡している
          mark: cmdfx/module.go:7

        - title: cmdfx.New()
          description: |
            cmdfx.ICmd は clientfx.IClient へ依存している
          mark: cmdfx/cmd.go:10

        - description: |
            cmdfx と clientfx は interface を介してやり取りしているのがポイント。これにより mock へ差し替えできる
          mark: cmdfx/cmd.go:24
